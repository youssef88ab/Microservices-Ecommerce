<div class="dashboard-container">
  <app-sidebar class="sidebar"></app-sidebar>
  <main class="content">
    <app-navbar></app-navbar>
    <div class="container-fluid py-5">
      <!-- Header Card -->
      <div class="card border-0 shadow-sm mb-5">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-6 mb-3 mb-md-0">
              <h1 class="fw-bold mb-2">Analytics Dashboard</h1>
              <p class="text-muted fs-5 mb-0">Track and analyze your business performance</p>
            </div>
            <div class="col-md-6 d-flex flex-wrap justify-content-md-end gap-3">
              <div class="input-group me-2" style="max-width: 220px;">
                <span class="input-group-text bg-white">
                  <i class="fas fa-calendar-alt text-primary"></i>
                </span>
                <select class="form-select border-start-0" [(ngModel)]="selectedDateRange" (change)="onDateRangeChange()">
                  <option value="7">Last 7 Days</option>
                  <option value="30">Last 30 Days</option>
                  <option value="90">Last 90 Days</option>
                  <option value="365">Last Year</option>
                </select>
              </div>
              <button class="btn btn-primary d-flex align-items-center px-3 py-2">
                <i class="fas fa-download me-2"></i>Export Report
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Cards Section -->
      <div class="row g-4 mb-5">
        <!-- Revenue Card -->
        <div class="col-md-3 col-sm-6">
          <div class="card h-100 border-0 shadow-sm hover-shadow transition">
            <div class="card-body d-flex p-4">
              <div class="bg-primary bg-opacity-10 p-3 rounded-3 me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                <i class="fas fa-dollar-sign text-primary fs-3"></i>
              </div>
              <div class="ms-2">
                <h6 class="text-muted mb-2">Total Revenue</h6>
                <h3 class="mb-2">${{ salesSummary.revenue | number:'1.0-0' }}</h3>
                <div class="text-success small d-flex align-items-center">
                  <i class="fas fa-arrow-up me-1"></i>
                  <span>{{ salesSummary.revenueGrowth }}% vs last period</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Orders Card -->
        <div class="col-md-3 col-sm-6">
          <div class="card h-100 border-0 shadow-sm hover-shadow transition">
            <div class="card-body d-flex p-4">
              <div class="bg-success bg-opacity-10 p-3 rounded-3 me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                <i class="fas fa-shopping-cart text-success fs-3"></i>
              </div>
              <div class="ms-2">
                <h6 class="text-muted mb-2">Total Orders</h6>
                <h3 class="mb-2">{{ salesSummary.orders | number:'1.0-0' }}</h3>
                <div class="text-success small d-flex align-items-center">
                  <i class="fas fa-arrow-up me-1"></i>
                  <span>{{ salesSummary.orderGrowth }}% vs last period</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Average Order Value Card -->
        <div class="col-md-3 col-sm-6">
          <div class="card h-100 border-0 shadow-sm hover-shadow transition">
            <div class="card-body d-flex p-4">
              <div class="bg-info bg-opacity-10 p-3 rounded-3 me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                <i class="fas fa-chart-line text-info fs-3"></i>
              </div>
              <div class="ms-2">
                <h6 class="text-muted mb-2">Avg. Order Value</h6>
                <h3 class="mb-2">${{ salesSummary.avgOrderValue | number:'1.0-2' }}</h3>
                <div class="text-success small d-flex align-items-center">
                  <i class="fas fa-arrow-up me-1"></i>
                  <span>{{ salesSummary.avgOrderValueGrowth }}% vs last period</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Conversion Rate Card -->
        <div class="col-md-3 col-sm-6">
          <div class="card h-100 border-0 shadow-sm hover-shadow transition">
            <div class="card-body d-flex p-4">
              <div class="bg-warning bg-opacity-10 p-3 rounded-3 me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                <i class="fas fa-percent text-warning fs-3"></i>
              </div>
              <div class="ms-2">
                <h6 class="text-muted mb-2">Conversion Rate</h6>
                <h3 class="mb-2">{{ salesSummary.conversionRate }}%</h3>
                <div [ngClass]="{'text-success': salesSummary.conversionRateGrowth > 0, 'text-danger': salesSummary.conversionRateGrowth < 0}" class="small d-flex align-items-center">
                  <i class="fas" [ngClass]="{'fa-arrow-up': salesSummary.conversionRateGrowth > 0, 'fa-arrow-down': salesSummary.conversionRateGrowth < 0}"></i>
                  <span class="ms-1">{{ getAbsoluteValue(salesSummary.conversionRateGrowth) }}% vs last period</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="row g-4 mb-5">
        <!-- Revenue Chart Card -->
        <div class="col-lg-8">
          <div class="card border-0 shadow-sm h-100 hover-shadow transition">
            <div class="card-header bg-white d-flex justify-content-between align-items-center py-4 px-4">
              <h5 class="card-title fw-bold mb-0">Revenue Overview</h5>
              <div class="btn-group" role="group">
                <button class="btn" [class.btn-primary]="chartPeriod === 'day'" [class.btn-outline-primary]="chartPeriod !== 'day'" (click)="setChartPeriod('day')">Daily</button>
                <button class="btn" [class.btn-primary]="chartPeriod === 'week'" [class.btn-outline-primary]="chartPeriod !== 'week'" (click)="setChartPeriod('week')">Weekly</button>
                <button class="btn" [class.btn-primary]="chartPeriod === 'month'" [class.btn-outline-primary]="chartPeriod !== 'month'" (click)="setChartPeriod('month')">Monthly</button>
              </div>
            </div>
            <div class="card-body p-4">
              <div style="height: 320px;">
                <canvas id="revenueChart"></canvas>
              </div>
            </div>
            <div class="card-footer bg-white d-flex justify-content-between align-items-center py-3 px-4">
              <div class="d-flex flex-wrap gap-4">
                <div class="d-flex align-items-center">
                  <span class="bg-primary d-inline-block me-2" style="width: 14px; height: 14px; border-radius: 3px;"></span>
                  <span class="small">Current Period</span>
                </div>
                <div class="d-flex align-items-center">
                  <span class="bg-primary bg-opacity-25 d-inline-block me-2" style="width: 14px; height: 14px; border-radius: 3px;"></span>
                  <span class="small">Previous Period</span>
                </div>
              </div>
              <button class="btn btn-outline-secondary d-flex align-items-center">
                <i class="fas fa-expand me-2"></i> Expand
              </button>
            </div>
          </div>
        </div>

        <!-- Categories Chart Card -->
        <div class="col-lg-4">
          <div class="card border-0 shadow-sm h-100 hover-shadow transition">
            <div class="card-header bg-white d-flex justify-content-between align-items-center py-4 px-4">
              <h5 class="card-title fw-bold mb-0">Sales by Category</h5>
              <div class="dropdown">
                <button class="btn btn-outline-secondary dropdown-toggle d-flex align-items-center" type="button" data-bs-toggle="dropdown">
                  <i class="fas fa-filter me-2"></i> Filter
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="#">All Categories</a></li>
                  <li><a class="dropdown-item" href="#">Top 5</a></li>
                  <li><a class="dropdown-item" href="#">Top 10</a></li>
                </ul>
              </div>
            </div>
            <div class="card-body p-4">
              <div style="height: 320px;">
                <canvas id="categoryChart"></canvas>
              </div>
            </div>
            <div class="card-footer bg-white py-3 px-4">
              <div class="d-flex align-items-center">
                <span class="text-muted fs-6 me-3">Top Category:</span>
                <span class="fw-bold fs-5">Clothes</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Products and Customer Insights Section -->
      <div class="row g-4">
        <!-- Top Products Card -->
        <div class="col-lg-8">
          <div class="card border-0 shadow-sm h-100 hover-shadow transition">
            <div class="card-header bg-white d-flex flex-wrap justify-content-between align-items-center gap-3 py-4 px-4">
              <h5 class="card-title fw-bold mb-0">Top Selling Products</h5>
              <div class="btn-group" role="group">
                <button class="btn" [class.btn-primary]="productSort === 'revenue'" [class.btn-outline-primary]="productSort !== 'revenue'" (click)="setProductSort('revenue')">
                  <i class="fas fa-dollar-sign me-2"></i>By Revenue
                </button>
                <button class="btn" [class.btn-primary]="productSort === 'quantity'" [class.btn-outline-primary]="productSort !== 'quantity'" (click)="setProductSort('quantity')">
                  <i class="fas fa-boxes me-2"></i>By Quantity
                </button>
              </div>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-hover mb-0">
                  <thead class="table-light">
                    <tr>
                      <th class="px-4 py-3">Product</th>
                      <th class="px-4 py-3">Category</th>
                      <th class="text-end px-4 py-3">Units Sold</th>
                      <th class="text-end px-4 py-3">Revenue</th>
                      <th class="text-end px-4 py-3">Growth</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let product of topProducts">
                      <td class="px-4 py-3">
                        <div class="d-flex align-items-center">
                          <img [src]="product.image" alt="Product" class="rounded" width="50" height="50">
                          <span class="ms-3 fw-medium">{{ product.name }}</span>
                        </div>
                      </td>
                      <td class="px-4 py-3">
                        <span class="badge bg-light text-dark px-3 py-2">{{ product.category }}</span>
                      </td>
                      <td class="text-end px-4 py-3">{{ product.quantitySold | number:'1.0-0' }}</td>
                      <td class="text-end px-4 py-3 fw-medium">${{ product.revenue | number:'1.0-0' }}</td>
                      <td class="text-end px-4 py-3">
                        <span class="badge px-3 py-2" [ngClass]="{'bg-success': product.growth > 0, 'bg-danger': product.growth < 0}">
                          {{ product.growth > 0 ? '+' : '' }}{{ product.growth }}%
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="card-footer bg-white d-flex justify-content-between align-items-center py-4 px-4">
              <button class="btn btn-outline-primary d-flex align-items-center">
                View All Products <i class="fas fa-arrow-right ms-2"></i>
              </button>
              <div class="text-muted small">
                <!-- Pagination info here if needed -->
              </div>
            </div>
          </div>
        </div>

        <!-- Customer Insights Card -->
        <div class="col-lg-4">
          <div class="card border-0 shadow-sm h-100 hover-shadow transition">
            <div class="card-header bg-white d-flex justify-content-between align-items-center py-4 px-4">
              <h5 class="card-title fw-bold mb-0">Customer Insights</h5>
              <button class="btn btn-outline-secondary d-flex align-items-center">
                <i class="fas fa-sliders-h me-2"></i> Customize
              </button>
            </div>
            <div class="card-body">
              <div class="d-flex flex-column gap-4">
                <!-- New Customers -->
                <div class="d-flex justify-content-between align-items-center">
                  <div class="d-flex align-items-center">
                    <div class="bg-primary bg-opacity-10 p-2 rounded-circle me-3">
                      <i class="fas fa-user-plus text-primary"></i>
                    </div>
                    <div>
                      <h6 class="text-muted mb-0">New Customers</h6>
                      <h3 class="mb-0">{{ customerInsights.newCustomers | number:'1.0-0' }}</h3>
                    </div>
                  </div>
                  <span class="badge bg-success">
                    <i class="fas fa-arrow-up me-1"></i>{{ customerInsights.newCustomerGrowth }}%
                  </span>
                </div>

                <!-- Repeat Customers -->
                <div class="d-flex justify-content-between align-items-center">
                  <div class="d-flex align-items-center">
                    <div class="bg-success bg-opacity-10 p-2 rounded-circle me-3">
                      <i class="fas fa-redo text-success"></i>
                    </div>
                    <div>
                      <h6 class="text-muted mb-0">Repeat Customers</h6>
                      <h3 class="mb-0">{{ customerInsights.repeatCustomers | number:'1.0-0' }}</h3>
                    </div>
                  </div>
                  <span class="badge bg-success">
                    <i class="fas fa-arrow-up me-1"></i>{{ customerInsights.repeatCustomerGrowth }}%
                  </span>
                </div>

                <!-- Avg. Customer Value -->
                <div class="d-flex justify-content-between align-items-center">
                  <div class="d-flex align-items-center">
                    <div class="bg-warning bg-opacity-10 p-2 rounded-circle me-3">
                      <i class="fas fa-star text-warning"></i>
                    </div>
                    <div>
                      <h6 class="text-muted mb-0">Avg. Customer Value</h6>
                      <h3 class="mb-0">${{ customerInsights.avgCustomerValue | number:'1.0-2' }}</h3>
                    </div>
                  </div>
                  <span class="badge bg-success">
                    <i class="fas fa-arrow-up me-1"></i>{{ customerInsights.avgCustomerValueGrowth }}%
                  </span>
                </div>
              </div>
            </div>
            <div class="card-footer bg-white py-3">
              <button class="btn btn-outline-primary w-100">
                <i class="fas fa-chart-pie me-1"></i> View Detailed Customer Analytics
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>